<div class="calendar-grid">
  {{#if calendarData}}
    <div class="calendar-weekdays"
      style="grid-template-columns: repeat({{calendarData.daysInWeek}}, minmax(80px, 1fr));">
      {{#each calendarData.weekdays}}
        <div class="weekday-header">{{this}}</div>
      {{/each}}
    </div>

    <div class="calendar-days">
      {{#each calendarData.weeks}}
        <div class="calendar-week"
          style="grid-template-columns: repeat({{../calendarData.daysInWeek}}, minmax(80px, 1fr));">
          {{#each this}}
            {{#if empty}}
              <div class="calendar-day empty"></div>
            {{else}}
              <div
                class="calendar-day{{#if isToday}} today{{/if}}{{#if isSelected}} selected{{/if}}{{#if notes.length}} has-notes{{/if}}{{#if isOddDay}} odd-day{{/if}}{{#if isFestival}} festival-day{{/if}}"
                data-year="{{year}}" data-month="{{month}}" data-day="{{day}}" data-action="selectDay"
                {{#if festivalName}}data-tooltip="{{festivalName}}" {{/if}}>
                <div class="day-number">
                  {{day}}
                  {{#if isFestival}}
                    <i class="fas fa-star festival-icon" data-tooltip="{{festivalName}}"></i>
                  {{/if}}
                  {{#each moonPhases}}
                    <span class="moon-phase" data-tooltip="{{moonName}}: {{phaseName}}">
                      <img src="{{icon}}" alt="{{phaseName}}" />
                    </span>
                  {{/each}}
                </div>
                {{#if notes.length}}
                  <div class="day-notes">
                    {{#each notes}}
                      <div class="note-indicator" data-tooltip="{{name}}" data-action="editNote" data-note-id="{{id}}">
                        {{#if (eq system.iconType "fontawesome")}}
                          <i class="{{system.icon}}" style="color: {{system.color}}"></i>
                        {{else}}
                          <img src="{{system.icon}}" alt="{{name}}" style="width: 16px; height: 16px;" />
                        {{/if}}
                      </div>
                    {{/each}}
                  </div>
                {{/if}}
                {{#if ../../../editable}}
                  <button type="button" class="add-note-btn" data-action="addNote" data-year="{{year}}"
                    data-month="{{month}}" data-day="{{day}}" data-tooltip="CALENDARIA.UI.AddNote">
                    <i class="fas fa-plus"></i>
                  </button>
                {{/if}}
              </div>
            {{/if}}
          {{/each}}

          <!-- Multi-day event bars -->
          {{#each multiDayEvents}}
            <div class="event-bar{{#if isContinuation}} continuation{{/if}}"
              style="left: {{left}}%; width: {{width}}%; top: calc(22px + {{row}} * 26px); background-color: {{color}};"
              data-tooltip="{{name}}" data-action="editNote" data-note-id="{{id}}">
              {{#if isContinuation}}
                <i class="fa-solid fa-angles-right event-bar-continuation"></i>
              {{else}}
                {{#if (eq iconType "fontawesome")}}
                  <i class="{{icon}} event-bar-icon"></i>
                {{else if icon}}
                  <img src="{{icon}}" alt="{{name}}" class="event-bar-icon" />
                {{/if}}
              {{/if}}
              <span class="event-bar-text">{{name}}</span>
            </div>
          {{/each}}
        </div>
      {{/each}}
    </div>
  {{else}}
    <div class="no-calendar">
      <p>No calendar configured. Select a calendar in the settings.</p>
    </div>
  {{/if}}
</div>

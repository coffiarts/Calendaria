<div class="calendaria-hud-bar-wrapper{{#if trayUp}} tray-up{{/if}}">
  <div class="calendaria-hud-search-panel{{#if searchOpen}} visible{{/if}}">
    <div class="search-panel-header">
      <input type="search" class="search-input" name="search" placeholder="{{localize 'CALENDARIA.Search.Placeholder'}}"
        value="{{searchTerm}}" autocomplete="off">
    </div>
    <div class="search-panel-results">
      {{#if searchResults.length}}
      {{#each searchResults}}
      <div class="search-result-item" data-action="openSearchResult" data-id="{{id}}"
        data-journal-id="{{data.journalId}}">
        <span class="result-name">{{name}}</span>
        {{#if description}}<span class="result-description">{{description}}</span>{{/if}}
      </div>
      {{/each}}
      {{else if searchTerm}}
      <div class="no-results">
        <i class="fas fa-search"></i>
        <span>{{localize "CALENDARIA.Search.NoResults"}}</span>
      </div>
      {{/if}}
    </div>
  </div>

  <div class="calendaria-hud-bar{{#if locked}} locked{{/if}}{{#if hasEvents}} has-events{{/if}}"
    {{#if hasEvents}}style="--event-glow: {{firstEventColor}};" {{/if}}>

    <div class="calendaria-hud-section left">
      <div class="calendaria-hud-btn-group left" role="group" aria-label="{{localize 'CALENDARIA.HUD.NoteActions'}}">
        <button type="button" class="calendaria-hud-btn" data-action="searchNotes"
          data-tooltip="{{localize 'CALENDARIA.Common.SearchNotes'}}">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
        <button type="button" class="calendaria-hud-btn" data-action="addNote"
          data-tooltip="{{localize 'CALENDARIA.Common.AddNote'}}">
          <i class="fa-solid fa-calendar-plus"></i>
        </button>
      </div>

      <div class="calendaria-hud-divider"></div>

      <div class="calendaria-hud-info-panel">
        <span class="calendaria-hud-date"{{#if canChangeDateTime}} data-action="setDate"
          data-tooltip="{{dateDisplay}} (Click to set date)"{{else}} data-tooltip="{{dateDisplay}}"{{/if}}>{{dateDisplay}}</span>
        {{#if hasEvents}}
        <div class="calendaria-hud-events">
          {{#each liveEvents}}
          <div class="calendaria-hud-event-icon-wrapper" data-action="openEvent" data-event-id="{{this.id}}"
            data-parent-id="{{this.parentId}}" data-tooltip="{{this.tooltip}}" style="--event-color: {{this.color}};">
            <i class="{{this.icon}} calendaria-hud-event-icon"></i>
          </div>
          {{/each}}
        </div>
        {{/if}}
      </div>
    </div>

    <div class="calendaria-hud-center">
      {{#if useSliceMode}}
      <div class="calendaria-hud-slice" {{#if canChangeDateTime}}role="button" tabindex="0" data-action="openTimeDial"
        data-tooltip="{{localize 'CALENDARIA.HUD.ClickToSetTime'}}"{{/if}}>
        <div class="calendaria-slice-sky"></div>
        <div class="calendaria-slice-track">
          <div class="calendaria-slice-body calendaria-slice-sun"></div>
          <div class="calendaria-slice-body calendaria-slice-moon"></div>
        </div>
        <div class="calendaria-slice-time-overlay">
          <span class="calendaria-hud-time">{{time}}</span>
          {{#if canChangeDateTime}}
          <button type="button" class="calendaria-hud-play-btn" data-action="toggleTimeFlow"
            aria-pressed="{{isPlaying}}"
            data-tooltip="{{#if isPlaying}}{{localize 'CALENDARIA.HUD.PauseTime'}}{{else}}{{localize 'CALENDARIA.TimeKeeper.Start'}}{{/if}}">
            <i class="fa-solid {{#if isPlaying}}fa-pause{{else}}fa-play{{/if}}"></i>
          </button>
          {{/if}}
        </div>
      </div>
      {{else}}
      <div class="calendaria-hud-time-wrapper">
        <span class="calendaria-hud-time">{{time}}</span>
        {{#if canChangeDateTime}}
        <button type="button" class="calendaria-hud-play-btn" data-action="toggleTimeFlow"
          aria-pressed="{{isPlaying}}"
          data-tooltip="{{#if isPlaying}}{{localize 'CALENDARIA.HUD.PauseTime'}}{{else}}{{localize 'CALENDARIA.TimeKeeper.Start'}}{{/if}}">
          <i class="fa-solid {{#if isPlaying}}fa-pause{{else}}fa-play{{/if}}"></i>
        </button>
        {{/if}}
      </div>
      {{/if}}
    </div>

    <div class="calendaria-hud-section right">
      <div class="calendaria-hud-indicators">
        {{#if weather}}
        <span class="weather-indicator{{#if canChangeWeather}} clickable{{/if}} weather-mode-{{weatherDisplayMode}}" {{#if canChangeWeather}}data-action="openWeatherPicker" {{/if}}
            style="--weather-color: {{weather.color}}" data-tooltip="{{weather.tooltip}}">
          {{#if showWeatherIcon}}<i class="{{weather.icon}}"></i>{{/if}}
          {{#if showWeatherLabel}}<span class="weather-label">{{weather.label}}</span>{{/if}}
          {{#if showWeatherTemp}}<span class="weather-temp">{{weather.temp}}</span>{{/if}}
        </span>
        {{else if showWeatherBlock}}
        {{#if canChangeWeather}}
        <span class="weather-indicator clickable no-weather" data-action="openWeatherPicker"
          data-tooltip="{{localize 'CALENDARIA.Weather.ClickToGenerate'}}">
          <i class="fas fa-cloud"></i>
        </span>
        {{/if}}
        {{/if}}
        {{#if currentSeason}}
        <span class="season-indicator" style="--season-color: {{currentSeason.color}}"
          data-tooltip="{{currentSeason.name}}">
          {{#if showSeasonIcon}}<i class="{{currentSeason.icon}}"></i>{{/if}}
          {{#if showSeasonLabel}}<span class="season-label">{{currentSeason.name}}</span>{{/if}}
        </span>
        {{/if}}
        {{#if currentEra}}
        <span class="era-indicator" data-tooltip="{{currentEra.name}}">
          <i class="fas fa-hourglass-half"></i>
        </span>
        {{/if}}
        {{#if cycleText}}
        <span class="cycle-indicator" data-tooltip="{{{cycleText}}}">
          <i class="fas fa-arrows-rotate"></i>
        </span>
        {{/if}}
      </div>

      <div class="calendaria-hud-divider"></div>

      <div class="calendaria-hud-btn-group right" role="group" aria-label="{{localize 'CALENDARIA.HUD.CalendarActions'}}">
        <button type="button" class="calendaria-hud-btn" data-action="openCalendar"
          data-tooltip="{{localize 'CALENDARIA.HUD.OpenCalendar'}}">
          <i class="fa-solid fa-calendar-days"></i>
        </button>
        <button type="button" class="calendaria-hud-btn" data-action="openSettings"
          data-tooltip="{{localize 'CALENDARIA.HUD.Settings.Name'}}">
          <i class="fa-solid fa-gear"></i>
        </button>
      </div>
    </div>
  </div>

  {{#if canChangeDateTime}}
  <div class="calendaria-hud-tray{{#if stickyTray}} visible{{/if}}">
    <button type="button" class="calendaria-hud-time-btn time-shortcut" data-action="toSunrise"
      data-tooltip="{{localize 'CALENDARIA.HUD.Sunrise'}}">
      <i class="fa-solid fa-sun"></i>
    </button>
    <button type="button" class="calendaria-hud-time-btn time-shortcut" data-action="toMidday"
      data-tooltip="{{localize 'CALENDARIA.HUD.Midday'}}">
      <i class="fa-solid fa-cloud-sun"></i>
    </button>
    <div class="calendaria-hud-tray-divider"></div>
    {{#if customJumps.dec2}}
    <button type="button" class="calendaria-hud-time-btn custom-jump" data-action="customDec2"
      data-tooltip="{{customJumps.dec2}}">
      {{customJumps.dec2}}
    </button>
    {{/if}}
    {{#if customJumps.dec1}}
    <button type="button" class="calendaria-hud-time-btn custom-jump" data-action="customDec1"
      data-tooltip="{{customJumps.dec1}}">
      {{customJumps.dec1}}
    </button>
    {{/if}}
    {{#if (or customJumps.dec1 customJumps.dec2)}}
    <div class="calendaria-hud-tray-divider"></div>
    {{/if}}
    <button type="button" class="calendaria-hud-time-btn" data-action="reverse"
      data-tooltip="{{localize 'CALENDARIA.HUD.Reverse'}}">
      <i class="fa-solid fa-backward"></i>
    </button>
    <select class="calendaria-hud-select" data-action="setIncrement"
      aria-label="{{localize 'CALENDARIA.HUD.TimeIncrement'}}">
      {{#each increments}}
      <option value="{{key}}" {{#if selected}}selected{{/if}}>{{label}}</option>
      {{/each}}
    </select>
    <button type="button" class="calendaria-hud-time-btn" data-action="forward"
      data-tooltip="{{localize 'CALENDARIA.HUD.Forward'}}">
      <i class="fa-solid fa-forward"></i>
    </button>
    {{#if (or customJumps.inc1 customJumps.inc2)}}
    <div class="calendaria-hud-tray-divider"></div>
    {{/if}}
    {{#if customJumps.inc1}}
    <button type="button" class="calendaria-hud-time-btn custom-jump" data-action="customInc1"
      data-tooltip="+{{customJumps.inc1}}">
      +{{customJumps.inc1}}
    </button>
    {{/if}}
    {{#if customJumps.inc2}}
    <button type="button" class="calendaria-hud-time-btn custom-jump" data-action="customInc2"
      data-tooltip="+{{customJumps.inc2}}">
      +{{customJumps.inc2}}
    </button>
    {{/if}}
    <div class="calendaria-hud-tray-divider"></div>
    <button type="button" class="calendaria-hud-time-btn time-shortcut" data-action="toSunset"
      data-tooltip="{{localize 'CALENDARIA.HUD.Sunset'}}">
      <i class="fa-solid fa-cloud-moon"></i>
    </button>
    <button type="button" class="calendaria-hud-time-btn time-shortcut" data-action="toMidnight"
      data-tooltip="{{localize 'CALENDARIA.HUD.Midnight'}}">
      <i class="fa-solid fa-moon"></i>
    </button>
  </div>
  {{/if}}
</div>
